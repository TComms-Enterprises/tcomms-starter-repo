
name: Generate SBOM (CycloneDX from venv)
on: [push, pull_request]
jobs:
  build-test-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: '3.11' }
      - run: python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt -r requirements-dev.txt pip install pytest pytest-cov bandit cyclonedx-bom
      - run: source .venv/bin/activate && bandit -r src -ll
      - run: source .venv/bin/activate && pytest
      - uses: returntocorp/semgrep-action@v1
        with: { config: p/ci }
      - run: source .venv/bin/activate && cyclonedx-py venv -o sbom-python.json
      - uses: actions/upload-artifact@v4
        with: { name: reports, path: "coverage.xml
sbom-python.json" }
